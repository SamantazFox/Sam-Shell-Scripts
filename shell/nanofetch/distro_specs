#!/bin/sh

IFS=$_new_IFS

#
# Distro name
#

# Default to linux distro type
# Only windows and *BSD will replace that.
distro_type="linux"


# Ubuntu / Debian
if [ -e /etc/lsb-release ]; then
	. /etc/lsb-release
	distro="$DISTRIB_ID $DISTRIB_RELEASE $DISTRIB_CODENAME"

# Fedora / CentOS / Arch Linux / Manjaroo / *BSD
elif [ -e /etc/os-release ]; then
	. /etc/os-release
	distro="${PRETTY_NAME:-$NAME}"

	# Replace $distro_type only for *BSD
	case "$NAME" in (*BSD*) distro_type="bsd";; esac

# RedHat
elif [ -e /etc/redhat-release ]; then distro=$(cat /etc/redhat-release)

# Msys2 / Cygwin / Git for windows
elif [ "$OS" = "Windows_NT" ]; then
	# Get the kernel version and system here
	ms_tmp=$(uname -s)
	system=${ms_tmp%%_*}
	kernel=${ms_tmp#*_}

	case $kernel in
		NT-11.0) ms_ver="11";; # to be confirmed
		NT-10.0) ms_ver="10";;
		NT-6.3)  ms_ver="8.1";;
		NT-6.2)  ms_ver="8";;
		NT-6.1)  ms_ver="7";;
		NT-6.0)  ms_ver="Vista";;
		NT-5.0)  ms_ver="XP";;
	esac

	distro="Microsoft Windows $ms_ver ($system)"
	distro_type="win"

# Fallback
else
	distro="Linux generic"
fi


#
# Kernel / Memory / CPU details
#

# Kernel version
if [ -z "$kernel" ]; then
	kernel="$(uname -m) $(uname -sr)"
fi


# Memory informations
get_mem_info()
{
	mem_total_kib=$1
	mem_avail_kib=$2
}

get_mem_info $(sed -nE '
	s/MemTotal:\s+([0-9]+) kB/\1/p
	s/MemAvailable:\s+([0-9]+) kB/\1/p
' /proc/meminfo)

mem_total_mib=$(( $mem_total_kib / 1024 ))
mem_avail_mib=$(( $mem_avail_kib / 1024 ))

mem_used_kib=$(( $mem_total_kib - $mem_avail_kib ))
mem_used_mib=$(( $mem_used_kib / 1024 ))

IFS=$_old_IFS


#
# Other
#

case $SHELL in
	*zsh)  shell=$($SHELL --version | sed -E 's/(\(.*\))//');;
	*bash) shell=$($SHELL --version | sed -E '1s/^(GNU [Bb]ash), version ([0-9.]+).*$/\1 \2/; q');;
	*)     shell="Unknown";;
esac
